{%- liquid
  assign mode = section.settings.mode | default: 'horizontal'
  # Calculate sizes
  assign sizes = '100vw'
  unless section.settings.style == 'full_screen'
    if settings.enable_sidebar
      assign sidebar_width = 100.00 | divided_by: 12 | times: settings.sidebar_width_on_desktop | round: 2
      assign desktop_sizes_base = 100 | minus: sidebar_width
    else
      assign desktop_sizes_base = 100
    endif

    assign desktop_sizes_css_base = desktop_sizes_base | append: 'vw'

    case section.settings.section_height
      when 'h-screen-50'
        assign height_constraint = '50vh'
      when 'h-screen-60'
        assign height_constraint = '60vh'
      when 'h-screen-70'
        assign height_constraint = '70vh'
      when 'h-screen-80'
        assign height_constraint = '80vh'
      else
        assign height_constraint = '100vh'
    endcase

    case section.settings.section_height_desktop
      when 'same_as_mobile'
        assign desktop_height_constraint = height_constraint
      when 'lg:h-screen-50'
        assign desktop_height_constraint = '50vh'
      when 'lg:h-screen-60'
        assign desktop_height_constraint = '60vh'
      when 'lg:h-screen-70'
        assign desktop_height_constraint = '70vh'
      when 'lg:h-screen-80'
        assign desktop_height_constraint = '80vh'
      else
        assign desktop_height_constraint = '100vh'
    endcase

    assign desktop_sizes = 'min(' | append: desktop_height_constraint | append: ', ' | append: desktop_sizes_css_base | append: ')'

    assign mobile_sizes = 'min(' | append: height_constraint | append: ', 100vw)'

    assign sizes = '(min-width: 990px) ' | append: desktop_sizes | append: ', ' | append: mobile_sizes
  endunless
-%}
<section
  id="section-{{ section.id }}"
  x-data="{ labelContent: '', focusVisible: false }"
  class="section-container"
  data-color-scheme="{{ section.settings.color_scheme }}"
  style="--top-spacing-adjust: {{ section.settings.space_above }}; --bottom-spacing-adjust: {{ section.settings.space_below }};"
>
  <div class="text-scheme-text bg-scheme-background pt-top-section-vertical-spacing pb-bottom-section-vertical-spacing">
  {%- liquid
    if section.settings.title != blank
      render 'section-title-horizontal', title: section.settings.title
    endif
    render 'slideshow', collections: section.settings.collection_list, content_source: 'collection_list', sizes: sizes, mode: mode
  -%}
  </div>

  {%- liquid
    if section.settings.labels_display == 'text_overlay_on_hover' or section.settings.labels_display == 'follow_mouse_on_hover'
      render 'overlay-labels' with section.settings.labels_display as labels_display
    endif
  -%}
</section>

{% schema %}
{
  "name": "Collection list slideshow",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading"
    },
    {
      "type": "collection_list",
      "id": "collection_list",
      "label": "Collections"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "mode",
      "label": "Mode",
      "options": [
        {
          "value": "horizontal",
          "label": "Horizontal"
        },
        {
          "value": "vertical",
          "label": "Vertical"
        }
      ],
      "default": "horizontal"
    },
    {
      "type": "select",
      "id": "style",
      "label": "Style",
      "options": [
        {
          "value": "inset",
          "label": "Inset"
        },
        {
          "value": "full_screen",
          "label": "Full screen"
        }
      ],
      "info": "Full screen style will crop media.",
      "default": "inset"
    },
    {
      "type": "select",
      "id": "section_height",
      "label": "Section height - mobile",
      "options": [
        {
          "value": "h-screen-50",
          "label": "50% screen height"
        },
        {
          "value": "h-screen-60",
          "label": "60% screen height"
        },
        {
          "value": "h-screen-70",
          "label": "70% screen height"
        },
        {
          "value": "h-screen-80",
          "label": "80% screen height"
        },
        {
          "value": "h-screen",
          "label": "Full screen"
        },
        {
          "value": "h-screen-adaptive",
          "label": "Adaptive full screen"
        }
      ],
      "info": "Adaptive full screen accounts for the header and hero section when calculating the height of the section.",
      "default": "h-screen-adaptive"
    },
    {
      "type": "select",
      "id": "section_height_desktop",
      "label": "Section height - desktop",
      "options": [
        {
          "value": "same_as_mobile",
          "label": "Same as mobile"
        },
        {
          "value": "lg:h-screen-50",
          "label": "50% screen height"
        },
        {
          "value": "lg:h-screen-60",
          "label": "60% screen height"
        },
        {
          "value": "lg:h-screen-70",
          "label": "70% screen height"
        },
        {
          "value": "lg:h-screen-80",
          "label": "80% screen height"
        },
        {
          "value": "lg:h-screen",
          "label": "Full screen"
        },
        {
          "value": "lg:h-screen-adaptive",
          "label": "Adaptive full screen"
        }
      ],
      "default": "same_as_mobile"
    },
    {
      "type": "range",
      "id": "max_width_of_slides",
      "min": 20,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Max width of slides on desktop",
      "default": 80,
      "info": "Does not apply to full screen style."
    },
    {
      "type": "header",
      "content": "Labels"
    },
    {
      "type": "checkbox",
      "id": "labels_show_titles_and_captions",
      "label": "Show collection titles",
      "default": true
    },
    {
      "type": "select",
      "id": "labels_display",
      "label": "Display",
      "options": [
        {
          "value": "footer",
          "label": "Slideshow footer"
        },
        {
          "value": "text_overlay_on_hover",
          "label": "Text overlay on hover"
        },
        {
          "value": "follow_mouse_on_hover",
          "label": "Follow mouse on hover"
        }
      ],
      "default": "footer",
      "info": "Customise overlay labels in [theme settings](/editor?context=theme&category=overlay+labels)."
    },
    {
      "type": "checkbox",
      "id": "labels_always_show_on_mobile",
      "label": "Always show labels on mobile",
      "default": false
    },
    {
      "type": "header",
      "content": "Controls"
    },
    {
      "type": "checkbox",
      "id": "show_index_and_total_slides",
      "label": "Show current index and total slides",
      "default": true
    },
    {
      "type": "header",
      "content": "Autoplay"
    },
    {
      "type": "checkbox",
      "id": "auto_rotate",
      "label": "Auto-rotate slides",
      "default": false
    },
    {
      "type": "range",
      "id": "change_slides_speed",
      "min": 3,
      "max": 9,
      "step": 2,
      "unit": "s",
      "label": "Change slides every",
      "default": 5
    },
    {
      "type": "header",
      "content": "Color"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "default": "scheme_1",
      "label": "Color scheme"
    }
  ],
  "presets": [
    {
      "name": "Collection list (slideshow)"
    }
  ],
  "disabled_on": {
    "groups": [
      "aside",
      "header",
      "footer",
      "custom.hero"
    ]
  }
}
{% endschema %}
